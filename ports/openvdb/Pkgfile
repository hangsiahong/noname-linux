name=openvdb
version=3.2.0
desc="A large suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids"
deps="openexr zlib tbb blosc log4cplus python-numpy boost ghostscript"
source="https://github.com/dreamworksanimation/openvdb/archive/v${version}.tar.gz
"

build() {
	cd $name-$version/$name
	for i in $source; do
		case $i in
		*patch) patch -p1 < ../../$i || die;;
		esac
	done
	find . -name Makefile -exec sed -i 's/isystem/I/g' {} \;
	sed -i 's/python\/include/include/g' Makefile
	sed -i 's/python\/lib/lib/g' Makefile
	
	make \
	rpath=no \
	shared=yes \
	libdir=/lib \
	OPENVDB_ENABLE_3_ABI_COMPATIBLE=ON \
	PYTHON_VERSION='2.7' \
	CPPUNIT_INCL_DIR='' \
	HDSO=/lib \
	PYTHON_LIB_DIR=/lib \
	PYTHON_INCL_DIR=/include/python2.7 \
	NUMPY_INCL_DIR=/include/python2.7/numpy \
	BOOST_PYTHON_LIB='-lboost_python' \
	CONCURRENT_MALLOC_LIB='-ltbbmalloc_proxy -ltbbmalloc' \
	GLFW_INCL_DIR= \
	EPYDOC= \
	DOXYGEN= \
	DESTDIR="$pkgdir" \
	all install || die
}
