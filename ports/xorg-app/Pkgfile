name=xorg-app
version=0.1
desc="part of all apps"
deps="libpng xbitmaps mesa libsm pixman libx11 libxkbfile libxxf86vm xorg-proto libxres libxmu libxshmfence libxtst libxv xcb-util libva libva-intel-driver harfbuzz xcb-util-wm xcb-util-image xcb-util-cursor xcb-util-renderutil xcb-util-keysyms libxaw libxcursor libxrandr libvdpau-va-gl"
source="
xkbcomp-1.4.0.tar.bz2
sessreg-1.1.1.tar.bz2
xauth-1.0.10.tar.bz2
sessreg-1.1.0-missing_path_wtmpx.patch
http://xorg.freedesktop.org/releases/individual/app/iceauth-1.0.7.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/luit-1.1.1.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/mkfontdir-1.0.7.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/mkfontscale-1.1.2.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/setxkbmap-1.3.1.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/smproxy-1.0.6.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/x11perf-1.6.0.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xbacklight-1.2.1.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xcmsdb-1.0.5.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xcursorgen-1.0.6.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xdpyinfo-1.3.2.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xdriinfo-1.0.5.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xev-1.2.2.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xgamma-1.0.6.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xhost-1.0.7.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xkbevd-1.1.4.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xkbutils-1.0.4.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xkill-1.0.4.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xlsatoms-1.1.2.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xlsclients-1.1.3.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xkbutils-1.0.4.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xmessage-1.0.4.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xmodmap-1.0.9.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xpr-1.0.4.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xprop-1.2.2.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xrandr-1.5.0.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xrdb-1.1.0.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xrefresh-1.0.5.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xset-1.2.3.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xsetroot-1.1.1.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xvinfo-1.1.3.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xinput-1.6.2.tar.bz2 
http://xorg.freedesktop.org/releases/individual/app/xwd-1.0.6.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xwininfo-1.1.3.tar.bz2
http://xorg.freedesktop.org/releases/individual/app/xwud-1.0.4.tar.bz2
"

build() {
	for package in $source
	do
		package="`basename ${package%.tar.bz2}`"
		if [ ! -d "$package" ]; then
			continue
		fi
		msg $package
		pushd $package
		case $package in
			luit* )
				line1="#ifdef _XOPEN_SOURCE"
				line2="#  undef _XOPEN_SOURCE"
				line3="#  define _XOPEN_SOURCE 600"
				line4="#endif"

				sed -i -e "s@#ifdef HAVE_CONFIG_H@$line1\n$line2\n$line3\n$line4\n\n&@" sys.c
				unset line1 line2 line3 line4
				;;
			 sessreg-* )
			 	patch -p1 -i "$srcdir/sessreg-1.1.0-missing_path_wtmpx.patch"
				sed -e 's/\$(CPP) \$(DEFS)/$(CPP) -P $(DEFS)/' -i man/Makefile.in
				;;
		esac
		./configure --prefix= --sysconfdir=/etc \
			--localstatedir=/var --disable-static --disable-xinerama --without-xinerama 
		make  || die
		make DESTDIR="$pkgdir" install  || die
		popd
	done
}
