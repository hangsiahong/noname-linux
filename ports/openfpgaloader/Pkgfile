version="0.1"
makedeps=["libftdi", "libusb", "libuargp"]
deps=["libftdi", "libusb", "libuargp"]
desc="Universal utility for programming FPGA"
source=[
	{url="https://github.com/trabucayre/openFPGALoader/archive/v$version.tar.gz"},
	{url="argp.patch"},
]

ext='''
	cd openFPGALoader-$version
	sed -i 's|MODE="0664", GROUP="plugdev"|TAG+="uaccess"|g' 99-openfpgaloader.rules
	patch -Np1 -i ../argp.patch
'''

build='''
	cd openFPGALoader-$version
	cmake . -Bbuild \
		-DCMAKE_INSTALL_PREFIX= \
		-DCMAKE_INSTALL_DATADIR=share \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_CXX_FLAGS="$CXXFLAGS" \
		-DENABLE_UDEV=True
	cmake --build build
	DESTDIR="${pkgdir}" cmake --build build --target install
	install -Dm 644 99-openfpgaloader.rules "$pkgdir"/lib/udev/rules.d/99-openfpgaloader.rules
	mv "$pkgdir/bin/openFPGALoader" "$pkgdir/bin/openfpgaloader"
'''
