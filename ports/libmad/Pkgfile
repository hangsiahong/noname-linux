name=libmad
version=0.15.1b
desc="A high-quality MPEG audio decoder"
deps="musl"
source="http://downloads.sourceforge.net/sourceforge/mad/libmad-${version}.tar.gz
libmad.patch
amd64-64bit.diff
frame_length.diff
optimize.diff"

ext() {
	cd libmad-$version
	patch -p1 -i "${srcdir}/libmad.patch" || die
	patch -p1 -i "${srcdir}/amd64-64bit.diff" || die
	patch -p1 -i "${srcdir}/frame_length.diff" || die
	patch -p1 -i "${srcdir}/optimize.diff" || die
}

build() {
	cd libmad-$version
	CFLAGS="$CFLAGS -ftree-vectorize -ftree-vectorizer-verbose=1"
	autoconf
	./configure --prefix=
	make || die
	make DESTDIR="${pkgdir}" install || die
}
