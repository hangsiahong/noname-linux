name=poppler
version=0.56.0
desc="Poppler is a PDF rendering library based on the xpdf-3.0 code base"
deps="libjpeg-turbo gcc cairo fontconfig openjpeg2 gtk lcms2 gobject-introspection icu qt5-base git python glib"
source="https://poppler.freedesktop.org/poppler-${version}.tar.xz"

build() {
	cd poppler-$version
	./configure --prefix= --sysconfdir=/etc \
		--localstatedir=/var --disable-static \
		--enable-cairo-output \
		--enable-xpdf-headers \
		--enable-libjpeg --enable-zlib \
		--enable-poppler-qt5 \
		--enable-poppler-glib \
		--enable-libopenjpeg=openjpeg2
	sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0 /g' libtool
	make || die
	sed -e 's/^glib_subdir =.*/glib_subdir =/' \
	-e 's/^qt4_subdir =.*/qt4_subdir =/' \
	-e 's/^qt5_subdir =.*/qt5_subdir =/' -i Makefile
	make DESTDIR="${pkgdir}" install || die
	make -C poppler DESTDIR="${pkgdir}" install-libLTLIBRARIES || die
	make -C glib DESTDIR="${pkgdir}" install || die
	make -C qt5 DESTDIR="${pkgdir}" install || die
}
