name=ldns
version=1.7.0
desc='Fast DNS library supporting recent RFCs'
deps="libressl libpcap"
source="https://www.nlnetlabs.nl/downloads/${name}/${name}-${version}.tar.gz
pc.patch"

ext() {
	cd $name-$version
	curl -O -L https://www.archlinux.org/packages/core/any/dnssec-anchors/download
	tar xpvf download
	install -Dm644 etc/trusted-key.key "$pkgdir"/etc/trusted-key.key
	patch -p1 -i ../pc.patch || die
}

build() {
	cd $name-$version
	./configure \
		--prefix= \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-rpath \
		--with-drill \
		--with-examples \
		--with-trust-anchor=/etc/trusted-key.key \
		--disable-dane-verify # needs openssl>=1.1.0

	make || die
	make DESTDIR="${pkgdir}" install || die
}
